# 限流

`限流` 是针对服务请求数量的一种自我保护机制，当请求数量超出服务负载时，自动丢弃新的请求，是系统高可用架构的第一步。服务有了 `限流` 之后，为什么还需要 `熔断` 呢？ `限流` 面向的是上游的服务，而 `熔断` 面向的是下游的服务。

# 两种设计算法

## 漏斗算法

`漏桶` 算法将 `服务的请求量限额` 比喻为一个一直装满水的桶，每隔固定时间向外漏 `N` 滴水。如果请求方接到了这滴水，就可以继续请求服务，如果没有接到，就需要等待下一滴水。也就是说，不管请求量有多少，单位时间内请求额度 (漏水流出的容量) 是固定的。

`漏桶` 的不足之处在于其速率限制是固定的，即使请求容量允许的情况下，仍然无法处理流量突增的场景。
## 令牌桶算法

`令牌桶` 算法定期向桶中添加令牌，**令牌的数目可以按照需要消耗的资源进行相应的调整**，请求服务时需要从桶中获取令牌，如果获取到令牌，可以正常访问，如果没有获取到令牌，可以选择等待，或者放弃。